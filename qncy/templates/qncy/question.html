{% extends "qncy/base.html" %}
{% load static %}
{% load qncy_voting %}

{% block head %}
<link rel="stylesheet" href="{% static 'core/css/form.css' %}">
<link rel="stylesheet" href="{% static 'qncy/css/question.css' %}">
{% endblock %}

{% block title %}{{ question.title }}{% endblock %}

{% block content %}
<h1 class="heading">{{ question.title }}</h1>

<div class="card">
    <form action="{% url 'qncy:vote_question' question.id %}" method="post">
        {% csrf_token %}
        <div class="card-score">{% vote question user %}</div>
        <input type="hidden" name="next" value="{{ request.path }}">
    </form>
    <div class="card-info">
        <p>{{ question.content }}</p>
        <div class="card-footer">
            <span>Asked by {% if question.author.pfp %}<img src="{{ question.author.pfp.url }}">{% endif %} <a href="{% url 'qncy:user_profile' question.author.username %}">{{ question.author.username }}</a></span>
            {% if question.tags.count %}
                <span>Tags: {% for tag in question.tags.all %}<a href="{% url 'qncy:tagged' tag.name %}">{{ tag.name }}</a> {% endfor %}</span>
            {% endif %}
        </div>
    </div>
</div>

<h2>Answers: {{ question.answer_count }}</h2>

{% if page_obj %}
    {% for answer in page_obj %}
        <div class="card">
            <div class="card-score">
            <form action="{% url 'qncy:vote_answer' answer.id %}" method="post">
                {% csrf_token %}
                {% vote answer user %}
                <input type="hidden" name="next" value="{{ request.path }}">
            </form>
            {% if user.is_authenticated and user == question.author %}
            <form action="{% url 'qncy:accept_answer' answer.id %}" method="post">
                {% csrf_token %}
                <button {% if answer.accepted %}title="Remove acceptance?"{% else %}title="Accept this answer?"{% endif %} type="submit" {% if answer.accepted %}name="clear"{% else %}name="accept"{% endif %}><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 -2 24 24" {% if answer.accepted %}class="accepted"{% endif %}><path d="M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"/></svg></button>
                <input type="hidden" name="next" value="{{ request.path }}">
            </form>
            {% elif answer.accepted %}
                <span title="Question owner accepted this answer"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 -2 24 24" class="accepted"><path d="M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"/></svg></span>
            {% endif %}
            </div>
            <div class="card-info">
                <p>{{ answer.content }}</p>
                <div class="card-footer">
                    <span>Answer by {% if answer.author.pfp %}<img src="{{ answer.author.pfp.url }}">{% endif %} <a href="{% url 'qncy:user_profile' answer.author.username %}">{{ answer.author.username }}</a></span>
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
    <p>Be the first to answer!</p>
{% endif %}

{% include "qncy/pagination.html" %} 

{% if user.is_authenticated %}
<form method="post" class="answer-form">
  {% csrf_token %}
  {{ form }}
  <button type="submit">Answer!</button>
</form>
{% endif %}

{% endblock %}